# Verification Scenarios
version: "1.0"
generated_at: "2025-02-07T12:00:00Z"

scenarios:
  - function_id: "CF-001"
    name: "SlackメッセージからA-Dイベントを抽出できる"

    input:
      type: "list[dict]"
      content: |
        [
          {
            "text": "[A] この機能の仕様が不明です。もしかしてバグ？",
            "url": "https://slack.com/archives/ABC123/p1234567890",
            "timestamp": "2025-02-07T10:00:00Z"
          },
          {
            "text": "試しにテストコードを書いて確認します",
            "url": "https://slack.com/archives/ABC123/p1234567891",
            "timestamp": "2025-02-07T10:05:00Z"
          },
          {
            "text": "ただの挨拶です",
            "url": "https://slack.com/archives/ABC123/p1234567892",
            "timestamp": "2025-02-07T10:10:00Z"
          }
        ]

    expected_output:
      type: "list[ADEvent]"
      validation_rules:
        - "少なくとも2つのイベントが抽出される（Aイベント1つ、Bイベント1つ）"
        - "3つ目のメッセージ（挨拶）からはイベントが抽出されない"
        - "各イベントのevent_typeが正しい（AまたはB）"
        - "各イベントのconfidenceが0.0-1.0の範囲内"
        - "各イベントにtopic_idが付与されている"

    edge_cases:
      - name: "空メッセージ"
        input: {"text": "", "url": "https://slack.com/archives/ABC123/p1", "timestamp": "2025-02-07T10:00:00Z"}
        expected: "イベントが抽出されない"
      - name: "複数のイベントタイプが混在するメッセージ"
        input: {"text": "[A] 不定だが、試しにテストします", "url": "https://slack.com/archives/ABC123/p2", "timestamp": "2025-02-07T10:00:00Z"}
        expected: "最初にマッチしたイベントタイプ（A）が抽出される"
      - name: "不明確なメッセージ"
        input: {"text": "なんとなく気になる", "url": "https://slack.com/archives/ABC123/p3", "timestamp": "2025-02-07T10:00:00Z"}
        expected: "イベントが抽出されるが、confidenceは低い（0.5-0.7程度）"

  - function_id: "CF-002"
    name: "抽出結果をconfidence（信頼度）付きでJSON形式で出力できる"

    input:
      type: "list[dict]"
      content: |
        [
          {
            "text": "[A] パフォーマンスが気になる",
            "url": "https://slack.com/archives/ABC123/p1234567890",
            "timestamp": "2025-02-07T10:00:00Z"
          }
        ]

    expected_output:
      type: "dict"
      content: |
        {
          "event_type": "A",
          "topic_id": "topic-12345678",
          "message_text": "[A] パフォーマンスが気になる",
          "message_url": "https://slack.com/archives/ABC123/p1234567890",
          "timestamp": "2025-02-07T10:00:00Z",
          "confidence": 0.9,
          "note": null
        }
      validation_rules:
        - "to_dict()メソッドで辞書形式に変換できる"
        - "明示的なタグ[A]がある場合、confidence >= 0.9"
        - "JSONシリアライズ可能である"

    edge_cases:
      - name: "タグなしのメッセージ"
        input: {"text": "この機能の仕様が不明", "url": "https://slack.com/archives/ABC123/p1", "timestamp": "2025-02-07T10:00:00Z"}
        expected: "confidenceは0.5-0.7程度"

  - function_id: "CF-003"
    name: "既存Topic台帳との紐付けができる"

    input:
      type: "list[dict] + list[str]"
      messages: |
        [
          {
            "text": "温度条件での割り込み遅延が気になる",
            "url": "https://slack.com/archives/ABC123/p1",
            "timestamp": "2025-02-07T10:00:00Z"
          },
          {
            "text": "温度条件での割り込み遅延について、テストしました",
            "url": "https://slack.com/archives/ABC123/p2",
            "timestamp": "2025-02-07T10:05:00Z"
          }
        ]
      existing_topics: []

    expected_output:
      type: "list[ADEvent]"
      validation_rules:
        - "2つのメッセージが同じTopic IDを持つ（類似した内容のため）"
        - "ただし、現状の実装はハッシュベースのみなので、実際には異なるTopic IDになる"
        - "※ この挙動は将来的な類似度マッチング実装時に改善予定"

    note: |
      現状のTopicIdGeneratorはメッセージの先頭20文字のハッシュを使用しているため、
      全く同じ文字列でない限り異なるTopic IDが生成される。
      これは「改善提案」で扱うべき課題である。
